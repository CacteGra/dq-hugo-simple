<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Setup A VPS, Secure SSH and Firewall (optional DNS redirecting) · DigitalQuint
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Matthieu Brion">
<meta name="description" content="How to configure your brand new Virtual Private Server with a secure access and a peace of mind.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Setup A VPS, Secure SSH and Firewall (optional DNS redirecting)">
  <meta name="twitter:description" content="How to configure your brand new Virtual Private Server with a secure access and a peace of mind.">

<meta property="og:url" content="//localhost:1313/blogs/setup-a-vps-secure-ssh-firewall-dns/">
  <meta property="og:site_name" content="DigitalQuint">
  <meta property="og:title" content="Setup A VPS, Secure SSH and Firewall (optional DNS redirecting)">
  <meta property="og:description" content="How to configure your brand new Virtual Private Server with a secure access and a peace of mind.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blogs">
    <meta property="article:published_time" content="2025-06-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-30T00:00:00+00:00">
    <meta property="article:tag" content="Dev">
    <meta property="article:tag" content="Ssh">




<link rel="canonical" href="//localhost:1313/blogs/setup-a-vps-secure-ssh-firewall-dns/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="//localhost:1313/">
      DigitalQuint
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact me</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/project-trashit/">Project TrashIt</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="//localhost:1313/blogs/setup-a-vps-secure-ssh-firewall-dns/">
          Setup A VPS, Secure SSH and Firewall (optional DNS redirecting)
        </a>
      </h1>
    </header>

    <ul>
<li>
<p>When ordering a Virtual Private Server (VPS), you either get access to it using a root login or a user with the provided password. Either way, you will need to change the password and create your own user.</p>
</li>
<li>
<h3 id="user-setup">
  User setup
  <a class="heading-link" href="#user-setup">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Username and password (received by email or via the hosting services console interface).
<code>adduser username</code>
Add it to sudo group:
<code>usermod -aG sudo username</code></p>
<p>Remove old user:<br>
<code>sudo deluser username</code><br>
Log in the new user<br>
<code>su - username</code></p>
</li>
<li>
<h3 id="securing-ssh">
  Securing SSH
  <a class="heading-link" href="#securing-ssh">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Now&rsquo;s the time to secure our SSH install to disallow anything but public key authentication.<br>
Generate SSH key for the current user.<br>
<code>ssh-keygen</code><br>
Ensure your user has the right permissions:<br>
<code>chmod -R go= ~/.ssh</code><br>
<code>chown -R username:username ~/.ssh</code><br>
Then you&rsquo;ll want to edit SSH config file in order to secure your install:<br>
<code>sudo nano /etc/ssh/sshd_config</code></p>
<pre tabindex="0"><code>...
PermitRootLogin no
...
PubkeyAuthentication yes
...
PasswordAuthentication no
...
</code></pre></li>
<li>
<p>For extra security you can also change the port used to connect via SSH:
From <code>#Port 22</code><br>
To <code>Port 99</code></p>
</li>
<li>
<p>Then enter the following commands to set up your firewall:</p>
<pre tabindex="0"><code>sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 22
sudo ufw enable
sudo ufw status verbose
sudo ufw allow http
sudo ufw allow https
sudo ufw reload
</code></pre><pre tabindex="0"><code>Include IPV6 in the firewall rules
# Set to yes to apply rules
# to support IPv6 (no means only IPv6 on loopback accepted).
# You will need to &#39;disable&#39; and then &#39;enable&#39; the firewall for the changes to take affect.
IPV6=yes
</code></pre><p>Verify that hosts contains this configuration, editing <em>/etc/hosts</em>:</p>
<pre tabindex="0"><code>127.0.1.1 machine_name
127.0.0.1 localhost.localdomain localhost machine_name
</code></pre><p>Then <code>/etc/hostname</code>:<br>
<code>machine_name</code></p>
</li>
<li>
<h3 id="firewalling">
  Firewalling
  <a class="heading-link" href="#firewalling">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>id:: 68627971-884c-4d70-a314-a211dc6a477b
<code>sudo apt install ufw</code><br>
<code>sudo nano /etc/default/ufw</code></p>
</li>
<li>
<h3 id="banning-ips-trying-to-get-inside-your-vps">
  Banning IPs trying to get inside your VPS
  <a class="heading-link" href="#banning-ips-trying-to-get-inside-your-vps">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>We can now install Fail2Ban in order to ban IP addresses trying to force their way onto our machines through SSH protocols.</p>
<pre tabindex="0"><code>sudo apt install fail2ban
sudo apt install sendmail
sudo sendmailconfig
</code></pre><p>Type &ldquo;Y&rdquo; to answer all questions</p>
<pre tabindex="0"><code>sudo systemctl enable fail2ban
sudo systemctl start fail2ban
sudo systemctl status fail2ban
</code></pre><p>Edit <code>/etc/fail2ban/jail.conf</code></p>
<p>Under [sshd] add:</p>
<pre tabindex="0"><code>[sshd]
logpath = %(sshd_log)s
filter = sshd
backend = systemd
enabled = true
port = 22
destemail = root@&lt;fq-hostname&gt;
sender = root@&lt;fq-hostname&gt;
ignoreip = 127.0.0.1/8 # add any static IP address you will connect from
action = %(action_mwl)s
mta = sendmail
maxretry = 3
findtime = 300
bantime = 3600
</code></pre><p><code>sudo systemctl restart fail2ban</code></p>
</li>
<li>
<h3 id="domain-name">
  Domain name
  <a class="heading-link" href="#domain-name">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Now onto making your domain name stick to your IP address. This should work with any DNS service, however interface might differ.<br>
Delete Porkbun records.<br>
In your domain DNS manager:<br>
Type A - Address record<br>
Leave <em>Host</em> blank<br>
Add the IP address of your server to <em>Answer</em> (that&rsquo;s what it&rsquo;s called on Porkbun):<br>
12.43.12.56<br>
Do the same again:<br>
Type A - Address record<br>
But for <em>Host</em> add:<br>
<em>www</em><br>
And your server&rsquo;s IP address to <em>Answer</em>.</p>
</li>
<li>
<p>Zoho third party mail setup:
Select <em>MX</em> (Mail Exchange record), add to <em>Answer</em>:<br>
mail (or whatever subdomain or even domain you want people to see in your email address)<br>
And to <em>Priority</em>:<br>
10<br>
Do the same for mx2.zoho.eu with <em>Priority</em> 20 and mx3.zoho.eu with <em>Priority</em> 30</p>
</li>
<li>
<p>MX your_domain.extension mx2.zoho.eu 600 20
MX your_domain.extension mx3.zoho.eu 600 50<br>
MX your_domain.extension mx.zoho.eu 600 10<br>
Zoho will ask you to input new DNS records, <em>TXT - Text Record</em> in order to link various features of your Zoho email account to your domain.<br>
If it does not work, retry again.</p>
</li>
<li>
<h3 id="git-configuration">
  Git configuration
  <a class="heading-link" href="#git-configuration">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<pre tabindex="0"><code>git config --global user.name username
git config --global user.email username@email.com
</code></pre></li>
</ul>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2025
     Matthieu Brion 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
